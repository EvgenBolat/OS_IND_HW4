# Хавронич Евгений Алексеевич, БПИ226
---
## Вариант 14
### Условие:
Вторая Задача о магазине (забывчивые покупатели). 

В магазине работают два отдела, каждый отдел обладает уникальным ассортиментом. В каждом отделе работает один продавец. В магазин ходят исключительно забывчивые покупатели, поэтому каждый покупатель носит с собой список из K товаров,которые желает купить. Покупатель приобретает товары точно в том порядке, в каком они записаны в его списке. Число товаров в списке от одного до пяти. При этом товары в списке расположены в случайном порядке, что заставляет покупателя многократно переходить от отдела к отделу, если это требуется для совершения покупок. Продавец может обслужить только одного покупателя за раз. Покупатель, вставший в очередь, засыпает пока не дойдет до продавца. Продавец засыпает, если в его отделе нет покупателей, и просыпается, если появится хотя бы один. Создать клиент–серверное приложение, моделирующее работу магазина в течение рабочего дня. 

## Программа была написана на оценку 8.


### Требования на 8:
- Теперь в  Server можно подключать несколько серверов-слушатей, предварительно создав их в отдельных терминалах с разными айпи(аргументы у программы сервера слушателя те же). Теперь аргументы имеют ввид: 5000 5001 127.0.0.2 5002 127.0.0.3 5003. Теперь можно добавлять до 10 пар айпи-порт серверов слушателей, и при запуске будет проводиться логирование состояний во все указанные сервера. Достигнуто это созданием массива серверов, где в каждый элемент сохраняется айпи и порт. Аналогично сделано и в клиенте, теперь аргументы там такого рода: 127.0.0.1 5000 5001 5 127.0.0.4 5002 127.0.0.5 5003. Аналогично можно вводить до 15 пар айпи-порт, но айпи не должны совпадать с теми, что вводились серверу. После запуска логирование также происходит во все сервера-слушатели.

Динамическое добавление и отключение серверов-слушателей достигнуто тем, что после обслуживания одного клиента, сервер спрашивает, необходимо ли изменить подключённые сервера-слушатели, ожидая ввода y или n. Если y, то щапрашивается количество используемых серверов, после чего в цикле спрашивается пара айпи-порт. То есть мы занова прописывае используемые сервера. Но если нам не нужно менять их, то нажимаем n, и программа отрабатывает на текущих серверах-слушателях.

### Требования на 6-7:
- Дополнительно разработана программа сервер слушатель. По традиции сначала запускаем MakeFile. После компиляции запускаем ListenerServer с параметрами: 5002
Затем запускаем Server с параметрами: 5000 5001 127.0.0.3 5002. Добавляется айпи и порт сервера слушателя(порт, который указывался в ListenerServer, а айпи адрес такой, чтобы он не совпадал ни с каким из программы Client).

После этого запускаем Client с параметрами: 127.0.0.1 5000 5001 5 127.0.0.4 5002. Аналогично добавляется айпи и порт сервера-слушателя. (по какой-то причине нужно писать несовпадающие айпи, как видим 127.0.0.3 и 127.0.0.4, но оно работает).

В программах клиенте и сервере всё работает так же, но теперь при выводе очередного состояния вызывается функция создания лога, которая формирует строчку, и отправляет её на сервер-слушатель. Сервер слушатель же просто её принимает и выводит в консоль.

### Требования на 4-5:
- Необходимо запустить MakeFile, после чего запустить Server с параметрами: 5000 5001

После чего программа создаст два потока, в котором будет открыт отдельный сервер на указанный порт. Таким образом имитируются продавцы каждого отдела. Они начинают ожидать клиентов.
Для появления клиентов необходимо запустить файл Client с аргументами: 127.0.0.1 5000 5001 5

Указываыется адрес сервера, в котором хранятся наши продавцы, и их порты. Число пять означает, что будет создано 5 покупателей.

После этого Программа создаёт заданное число потоков, и каждый выполняет функцию Customer. В ней рандомно определяется, какое количество продуктов необходимо купить, и на каждой итерации похода рандомно, в какой из отделов нужно идти. После этого покупатель идёт в нужный отдел и встаёт в очередь, стучась в сервер нужндого продавца. Если он не занят, то создаётся связь, иначе он встаёт в очередь, дожидаясь освобождения продавца.
Покупатель в цикле ожидает получение сообщения, где первый элемент равен 0, что означает, что продавец начал пробивать товар. Получая от него затем через некоторое время сообщение '1', он понимает, что товар можно оплатить, и уходит, закрывая связь с сервером, и уходя на повторную итерацию.

Продавец во время связи отправляет сообщение '0', потом якобы пробивает товар некоторое время, и затем отправляет сообщение '1', после чего завершает с ним общение.

Когда отработают все покупатели, сервер будет готов дальше принимать клиентов, для его закрытия нажимаем ctr+c. Клиенты завершаются сами собой.
Вывод состояния осуществляется через printf.

К слову порты можно указывать любые корректные, лишь бы они совпадали (пара портов и в одной программе и в другой одинаковы), как и число студентов может быть в пределе до 10 (рекомендую так, чтобы программа не так долго работала.

Ниже прикладываю примеры вывода на 8 баллов, он не сильно отличается от выводов на баллы 4-5, и 6-7

### Пример выводимых данных
Пример вывода в Client:
```
662: Товар находится в первом отделе.

664: Товар находится во втором отделе.
663: Товар находится в первом отделе.

665: Товар находится в первом отделе.

666: Товар находится во втором отделе.
~/IndHW5$ 662: Иду в нужный отдел
664: Иду в нужный отдел
664: Пришёл, жду своей очереди
662: Пришёл, жду своей очереди
663: Иду в нужный отдел
665: Иду в нужный отдел
666: Иду в нужный отдел
664: Продавец проводит пробивание товара.
664: Оплатил и получил товар

662: Продавец проводит пробивание товара.
664: Товар находится во втором отделе.
662: Оплатил и получил товар

662: Товар находится во втором отделе.
664: Иду в нужный отдел
662: Иду в нужный отдел
```

Пример вывода в Server:
```
Продавец 629: Ожидаю нового покупателя
Продавец 630: Ожидаю нового покупателя
Продавец 629: Покупатель появился
Продавец 629: Сообщаю, что принял заказ
Продавец 630: Покупатель появился
Продавец 629: Сообщаю, что провожу пробивание товара на кассе
Продавец 630: Сообщаю, что принял заказ
Продавец 630: Сообщаю, что провожу пробивание товара на кассе
Продавец 629: Сообщаю, что выполнил заказ
Продавец 630: Сообщаю, что выполнил заказ
Продавец 630: Завершаю общение с данным покупателем
Продавец 630: Покупатель ушел
Продавец 629: Завершаю общение с данным покупателем

Продавец 630: Вы хотите изменить состав серверов-слушателей?(Введите y или n)
Продавец 629: Покупатель ушел

Продавец 629: Вы хотите изменить состав серверов-слушателей?(Введите y или n)

```

Пример вывода подключённого сервера-слушателя:
```
Продавец 491: Ожидаю покупателя
Продавец 492: Ожидаю покупателя
Продавец 629: Ожидаю покупателя
Продавец 630: Ожидаю покупателя
662: Товар в первом отделе.
663: Товар в первом отделе.
662: Иду в нужный отдел
664: Товар во втором отделе.
664: Иду в нужный отдел
663: Иду в нужный отдел
665: Товар в первом отделе.
665: Иду в нужный отдел
666: Товар во втором отделе.
666: Иду в нужный отдел
662: Пришёл, жду своей очереди
664: Пришёл, жду своей очереди
Продавец 629: Покупатель появился
Продавец 629: принял заказ
Продавец 630: Покупатель появился
Продавец 629: пробиваю товар
Продавец 630: принял заказ
664: Продавец пробивает товар.
Продавец 630: пробиваю товар
663: Пришёл, жду своей очереди
662: Продавец пробивает товар.
665: Пришёл, жду своей очереди
666: Пришёл, жду своей очереди
Продавец 629: выполнил заказ
Продавец 630: выполнил заказ
Продавец 629: общение завершено
Продавец 630: общение завершено
664: Оплатил и получил товар.
Продавец 630: Покупатель ушёл
Продавец 629: Покупатель ушёл
664: Товар во втором отделе.
662: Оплатил и получил товар.
664: Иду в нужный отдел
662: Товар во втором отделе.
662: Иду в нужный отдел
664: Пришёл, жду своей очереди
662: Пришёл, жду своей очереди
```

![](https://i.pinimg.com/564x/e0/3f/b0/e03fb08ff2e84aa211bcad6c5b487526.jpg)
